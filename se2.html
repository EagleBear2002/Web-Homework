<!doctype html>
<html>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width initial-scale=1'>
    <title>se2</title>
    <link href="css/waterMark.css" type="text/css" rel="stylesheet">
</head>

<body>

<div class="warkmask-conotainer">
    <div class="watermark "></div>
</div>

<div class='typora-export-content'>
    <div id='write' class=' first-line-indent'><h1 id='我是主页'><span>20221128-摄于南园</span></h1>
        <p><img id="image1" style="width:80%" src="images/se2.jpg" alt=""></p>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<!--<script type="text/javascript" src="js/cryptostego.min.js"></script>-->
<script type="text/javascript" src="js/main.js"></script>
<script type="text/javascript" src="js/mersenne-twister.js"></script>
<script type="text/javascript" src="js/readimg.js"></script>
<script type="text/javascript" src="js/setimg.js"></script>
<script type="text/javascript" src="js/sha512.js"></script>
<script type="text/javascript" src="js/waterMark.js"></script>
<script type="text/javascript" src="js/utf_8.js"></script>
<script type="text/javascript" src="js/utils.js"></script>

<script>
    function writeIMG(localLink) {
        console.log("begin of load");
        loadImgToCanvas(localLink, write);
        console.log("end of load");

        function write() {
            console.log("傅里叶变化开始");
            if (writeMsgToCanvas('canvas', '201250172', '', 0) === true) {
                console.log("傅里叶变化成功");

                var myCanvas = document.getElementById("canvas");
                var image = myCanvas.toDataURL("image/png");

                var element = document.getElementById('image1')
                element.setAttribute('src', image)
            }
        }

    }

    function loadImgToCanvas(src, callback) {
        console.log("loadImgToCanvas");
        maxsize = 500;
        var image = new Image();
        image.onload = function () {
            console.log("onload")
            var w = image.width;
            var h = image.height;
            if (maxsize > 0) {
                if (w > maxsize) {
                    h = h * (maxsize / w);
                    w = maxsize;
                }
                if (h > maxsize) {
                    w = w * (maxsize / h);
                    h = maxsize;
                }
                w = Math.floor(w);
                h = Math.floor(h);
            }
            var canvas = document.createElement('canvas');
            canvas.id = 'canvas';
            canvas.width = w;
            canvas.height = h;
            canvas.style.display = "none";
            var body = document.getElementsByTagName("body")[0];
            body.appendChild(canvas);
            var context = canvas.getContext('2d');
            context.drawImage(image, 0, 0, image.width, image.height, 0, 0, w, h);
            callback();
            document.body.removeChild(canvas);
        };
        image.src = src;
    }

    var link = window.location.search.substring(1)
    link = "images/" + link
    console.log("link = " + link)
    writeIMG(link)
</script>

<script src="js/waterMark.js" type="text/javascript" rel="script"></script>
</body>
</html>